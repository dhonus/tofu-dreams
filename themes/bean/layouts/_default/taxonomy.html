{{ define "main" }}

<!-- get subtags -->
{{ $categories := slice }}
{{ range .Paginator.Pages }}
    {{ with .GetTerms "tags" }}
        {{ range . }}
            {{ $categories = $categories | append .LinkTitle }}
        {{ end }}
    {{ end }}
{{ end }}

{{ if ( gt ( len $categories ) 0 ) }}
    <h3>All categories:</h3>
    <div class="tags">
        {{ range ($categories | uniq) }}
        <div uk-filter-control='[data-tag~="{{ . }}"]'>
            <a href="/tags/{{ . }}">{{ . }}</a>
        </div>
        {{ end }}
    </div>
{{ end }}

<div class="category_container">
    <div class="container">
        <h1>{{ .Title }}</h1>
        <div class="category">
            {{ range .Paginator.Pages.ByDate.Reverse }}
                <span class="article">
                    <a href="{{ .Permalink }}">
                        {{ with .Resources }}
                            {{ with .GetMatch "{cover.*,*.jpg,*.png,*.jpeg}" }}
                                    <div class="cover_image"
                                         style="background-image: url({{ .Permalink }});"></div>
                            {{ end }}
                        {{ end }}
                    </a>
                    <a href="{{ .Permalink }}">{{ .Title }}</a>
                    {{ .Summary | truncate 200 }}
                    {{ if .Truncated }}
                    <!-- This <div> includes a read more link, but only if the summary is truncated... -->
                    <div>
                        <a href="{{ .RelPermalink }}">Read More…</a>
                    </div>
                {{ end }}
                    </span>
            {{ end }}
        </div>
    </div>
</div>

<nav class="pagination">
    {{ if .Paginator.HasPrev }}
    <a class="prev" href="{{ if .Paginator.HasPrev }}{{ .Paginator.Prev.URL }}{{ else }}#{{ end }}">« Prev</a>
    {{ end }}
    {{ if .Paginator.HasNext }}
    <a class="next" href="{{ if .Paginator.HasNext }}{{ .Paginator.Next.URL }}{{ else }}#{{ end }}">Next »</a>
    {{ end }}
</nav>
{{ end }}

